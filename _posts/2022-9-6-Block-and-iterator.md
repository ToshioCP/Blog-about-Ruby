---
layout: posts
title: ブロックとイテレータ
description: ブロックとイテレータの初歩的な説明
category: 基本事項
date: 2022-9-6 21:00:00 +0900
---
ブロックはRubyの特長です。
ブロックのおかげで記述が非常にすっきりと分かりやすくなります。
今回はブロックをイテレータの本体として使う方法を説明します。

## 繰り返し

同じことを何回もやるときのブログラムについて述べます。例えばHello worldを3回表示したければ、

```ruby
print "Hello world.\n"
print "Hello world.\n"
print "Hello world.\n"
```

でも良いのですが、もっと良い方法があります。
整数のメソッドにtimesというのがあります。
これはそのメソッドに付属するブロックをその整数の回数だけ繰り返すというメソッドです。

```ruby
3.times do
  print "Hello world.\n"
end
```

`do`から`end`までを「ブロック」といいます。
ブロックにはRubyの任意のプログラムを書けます。
timesメソッドはその整数の回数だけ繰り返すので、10回繰り返したければ10のtimesメソッドを使えば良いのです。

```ruby
10.times do
  print "Hello world.\n"
end
```

他の言語にもブロックがあるのかどうかは知りませんが、少なくともCにはありません。
Cでブロックと同じようなことをするには関数へのポインタを使いますが、Rubyのようにスマートにしかも短く書くことはできません。
むしろCではfor文を使ったループの方が素直なプログラムになります。

timesのように繰り返しをするメソッドでループを表現することをイテレーションといいます。

## uptoメソッド

整数のメソッドで有用なもう一つはuptoです。
このメソッドにはパラメータがあります。

```ruby
1.upto 5 do |i|
  print i
  print "\n"
end
```

整数1のuptoメソッドは1から始めて引数の5までをブロックのパラメータの`i`に代入してループします。
パラメータの文字は`i`でなくても、例えば`limit`のような5文字でも構いません。
この文字は変数というものの一種です。
変数は文字列ではないのでダブルクォートで囲むことはしません。
変数については別の回で詳しく説明します。

ブロックのパラメータは縦棒`|`で囲むことになっています。
それに対してメソッドの引数はカッコ`(`と`)`で囲むか、半角空白でメソッドと引数を離すのでした。
メソッドとブロックは似ていますが、本質的に違うものです。

実行すると

```
1
2
3
4
5
```

と表示されます。

uptoに似たメソッドでdowntoがあります。
これはその整数から1ずつ小さくなって、引数まで繰り返します。

```ruby
10.downto(6) do |i|
  print i
  print "\n"
end
```

ここではメソッドdowntoの引数にカッコをつけました。
半角空白で離してカッコを省略する書き方もできます。
実行すると

```
10
9
8
7
6
```

と表示されます。

## ブロックの2つの書き方

ブロックは、do, endで囲みましたが、これを波カッコにすることもできます。

```ruby
1.upto(5) {|i| print i; print "\n"}
```

波カッコでは、ブロックが短く、1行で書ける時に使う人が多いと思います。
注意すべきは

- 引数にはカッコをつけなければいけない。
メソッドとカッコの間に半角空白を**入れない**。
この理由は、Rubyがdo-endよりも{ }の方をその前の引数と強く結びつけるためです（構文解析上の問題）。
- 1行に2つの文を入れるときはセミコロンで区切る

ということです。

私は以前はdo-endを多く使っていましたが、最近は波カッコが多くなってきました。
というのは、Rubyのメソッドは優れていて、一行でブロックが収まることが多いからです。
どちらを使うかはメソッドによって9割くらい決まるように思います。
今回のtimes、upto、downtoはdo-endを使うことが多いかもしれません。
